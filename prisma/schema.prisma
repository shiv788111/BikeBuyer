generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ================= ENUMS ================= 

enum RequestStatus {
  pending
  accepted
  rejected
}

enum Role {
  buyer
  seller
  admin
}

enum BikeStatus {
  available
  sold
  inactive
}

enum BikeCondition {
  Excellent
  Good
  Average
}

enum VehicleType {
  BIKE
  SCOOTY
}

// ================= MODELS =================

// -------- Users --------
model User {
  userId   Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
  role     Role   @default(buyer)

  agency     Agency?  //If a user is a seller, they can create one agency.If a user is a buyer, they do not have any agency.

  buyerRequests  RequestQuery[] @relation("BuyerRequests")
  sellerRequests RequestQuery[] @relation("SellerRequests")

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

// -------- Seller / Agency --------
model Agency {
  agencyId Int @id @default(autoincrement())
  userId   Int @unique

  shopName  String?
  ownerName String
  phone     String
  address   String
  city      String
  state     String
  pincode   String

  user     User      @relation(fields: [userId], references: [userId])
  vehicles Vehicle[]// “Multiple vehicles can exist, that’s why an array is used.”

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

// -------- Vehicles --------
model Vehicle {
  vehicleId Int @id @default(autoincrement())
  agencyId  Int

  brand       String
  model       String
  year        Int
  price       Float
  kmDriven    Int
  condition   BikeCondition
  status      BikeStatus    @default(available)
  vehicleType VehicleType
  description String?

  agency   Agency         @relation(fields: [agencyId], references: [agencyId])
  images   VehicleImage[] //“Multiple images can exist, so an array is used.”
  requests RequestQuery[] @relation("VehicleRequests")  
   //“One vehicle can have multiple  request” and No foreign key exists here, for request so `fields` and `references` are NOT required.

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

// -------- Vehicle Images --------
model VehicleImage {
  vehicleImageId Int    @id @default(autoincrement())
  vehicleId      Int
  imageUrl       String

  vehicle Vehicle @relation(fields: [vehicleId], references: [vehicleId])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

// -------- Request Queries --------
model RequestQuery {
  requestId Int @id @default(autoincrement())

  vehicleId Int
  buyerId   Int
  sellerId  Int

  message String?
  status  RequestStatus @default(pending)

  vehicle Vehicle @relation("VehicleRequests", fields: [vehicleId], references: [vehicleId])
  buyer   User    @relation("BuyerRequests", fields: [buyerId], references: [userId])
  seller  User    @relation("SellerRequests", fields: [sellerId], references: [userId])

  /*---It is necessary to name them BuyerRequest and SellerRequest
  because two users are being referenced from the same table;
  otherwise Prisma will throw an error.---*/


  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}
